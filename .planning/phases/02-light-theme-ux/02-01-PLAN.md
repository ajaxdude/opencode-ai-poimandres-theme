---
phase: 02-light-theme-ux
plan: 01
type: execute
wave: 1
depends_on: []
files_modified:
  - .opencode/themes/poimandres-light.json
  - README.md
autonomous: true
user_setup: []

must_haves:
  truths:
    - "Light theme file exists and can be selected via /theme command"
    - "All 56 theme properties defined for both dark and light modes"
    - "Light colors derived from accessible variant maintaining Poimandres aesthetic"
    - "WCAG AA contrast compliance verified (4.5:1 text, 3:1 UI)"
    - "README documents all 20 defs color tokens with hex values"
    - "README has usage examples for theme switching via /theme command"
    - "README has variant comparison table with all four themes"
  artifacts:
    - path: ".opencode/themes/poimandres-light.json"
      provides: "Light theme variant with complete semantic mappings"
      min_lines: 200
    - path: "README.md"
      provides: "Comprehensive documentation with color tokens and variant comparison"
      contains: "### Color Tokens (All Variants)"
  key_links:
    - from: ".opencode/themes/poimandres-light.json"
      to: ".opencode/themes/poimandres-accessible.json"
      via: "Extract light mode colors from accessible variant"
      pattern: "poimandres.*AccessibleLight"
    - from: "README.md"
      to: ".opencode/themes/poimandres-light.json"
      via: "Documentation references all theme files"
      pattern: "poimandres-light.json"
    - from: ".opencode/themes/poimandres-light.json"
      to: "scripts/validate-contrast.ts"
      via: "Validation script verifies WCAG AA compliance"
      pattern: "npx tsx validate-contrast.*poimandres-light"
---

<objective>
Create a dedicated light theme variant (poimandres-light.json) derived from the accessible variant, validate WCAG AA compliance, and update README with comprehensive color token documentation and usage examples.

Purpose: Provide users with a light mode option that maintains Poimandres aesthetic while ensuring full accessibility compliance.

Output: Light theme variant file (poimandres-light.json), validated WCAG AA compliance report, and updated README with color tokens documentation and usage examples.
</objective>

<execution_context>
@/home/papa/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/papa/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md

@.opencode/themes/poimandres.json
@.opencode/themes/poimandres-accessible.json
@.opencode/themes/poimandres-turquoise-expanded.json

@scripts/color-utils.ts
@scripts/validate-contrast.ts

# Phase 1 patterns: Preserve hue/saturation, adjust lightness for aesthetic consistency
# Phase 1 accessible variant already has validated light mode colors (100% WCAG AA)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create light theme variant file</name>
  <files>.opencode/themes/poimandres-light.json</files>
  <action>
Create .opencode/themes/poimandres-light.json as follows:

1. Read .opencode/themes/poimandres-accessible.json to extract structure and light mode colors
2. Create new theme file with structure matching poimandres.json (schema + defs + theme)
3. In defs section:
   - Include all base poimandres colors from original (poimandresBg, poimandresFocus, poimandresGray, etc.)
   - Include all accessible light mode colors (poimandres*AccessibleLight)
   - Ensure 20+ color definitions total matching original theme structure
4. In theme section:
   - For all 56 theme properties (primary, secondary, accent, error, warning, success, info, text, textMuted, background, backgroundPanel, backgroundElement, border, borderActive, borderSubtle, 10 diff colors, 13 markdown colors, 10 syntax colors, 4 input colors)
   - Set dark variant to use poimandres-accessible.json dark colors (preserving accessibility)
   - Set light variant to use light mode colors from defs section
   - Ensure every color reference in theme section has corresponding entry in defs section
5. Verify JSON is valid and matches opencode.ai theme schema format ($schema field present)

Do NOT modify original poimandres.json, poimandres-turquoise-expanded.json, or poimandres-accessible.json files.

Follow poimandres-accessible.json light mode color mappings (already validated for WCAG AA):
- primary.light: poimandresPrimaryAccessibleLight (#157a64)
- secondary.light: poimandresSecondaryAccessibleLight (#3d70a1)
- accent.light: poimandresAccentAccessibleLight (#00797c)
- error.light: poimandresErrorAccessibleLight (#44152e)
- warning.light: poimandresWarningAccessibleLight (#3f1538)
- text.light: poimandresGrayAccessibleLight (#1f272f)
- etc.

Light colors are derived from dark palette preserving hue/saturation, only adjusting lightness for accessibility (Phase 1 established pattern).
  </action>
  <verify>
File .opencode/themes/poimandres-light.json exists with valid JSON structure.
Command: node -e "JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-light.json', 'utf8')); console.log('✓ Valid JSON')"
Expected output: "✓ Valid JSON"

Check theme section has all 56 properties:
Command: node -e "const t = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-light.json', 'utf8')); const props = Object.keys(t.theme).length; console.log(\`Theme properties: \${props}/56\`)"
Expected output: "Theme properties: 56/56"

Check defs section has 20+ color definitions:
Command: node -e "const t = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-light.json', 'utf8')); const defs = Object.keys(t.defs).length; console.log(\`Defs colors: \${defs}\`)"
Expected output: "Defs colors: 20" or higher

Verify all theme.*.light values reference defs:
Command: node -e "
const t = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-light.json', 'utf8'));
const defs = Object.keys(t.defs);
const missing = [];
for (const [key, val] of Object.entries(t.theme)) {
  if (val.light && !defs.includes(val.light)) {
    missing.push(\`\${key}.light -> \${val.light}\`);
  }
}
if (missing.length > 0) {
  console.log('Missing defs references:');
  missing.forEach(m => console.log('  ' + m));
  process.exit(1);
}
console.log('✓ All light colors reference defs');
"
Expected output: "✓ All light colors reference defs"
  </verify>
  <done>
File .opencode/themes/poimandres-light.json exists with:
- Valid JSON matching opencode.ai theme schema ($schema field present)
- 20+ color definitions in defs section
- All 56 theme properties defined (primary, secondary, accent, error, warning, success, info, text, textMuted, background, backgroundPanel, backgroundElement, border, borderActive, borderSubtle, 10 diff colors, 13 markdown colors, 10 syntax colors, 4 input colors)
- Each theme property has both dark and light variants
- All light colors reference defs section (no missing references)
- Light colors derived from poimandres-accessible.json preserving Poimandres aesthetic
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate WCAG AA compliance</name>
  <files>.opencode/themes/poimandres-light.json</files>
  <action>
Validate WCAG AA compliance for poimandres-light.json using existing validation script:

1. Run npx tsx scripts/validate-contrast.ts .opencode/themes/poimandres-light.json
2. Check output confirms 100% WCAG AA compliance (24/24 color pairs pass)
3. Verify all critical pairs meet 4.5:1 contrast for normal text
4. Verify all UI element pairs meet 3:1 contrast ratio
5. If any pair fails, identify which property and adjust lightness in defs section while preserving hue/saturation
6. Re-run validation until 100% compliance achieved

Since poimandres-light.json derives light colors from poimandres-accessible.json (which achieved 100% compliance in Phase 1), validation should pass without adjustments.

Do NOT create new validation scripts - reuse existing scripts/validate-contrast.ts from Phase 1.
  </action>
  <verify>
Run validation script and check compliance percentage:
Command: npx tsx scripts/validate-contrast.ts .opencode/themes/poimandres-light.json | grep "WCAG AA Compliance"
Expected output: "WCAG AA Compliance: 100% (24/24 pairs pass)"

Check for failing pairs (should be zero):
Command: npx tsx scripts/validate-contrast.ts .opencode/themes/poimandres-light.json | grep "FAILING PAIRS" -A 20
Expected output: "FAILING PAIRS: 0" or similar message indicating zero failures

Verify text contrast meets 4.5:1:
Command: npx tsx scripts/validate-contrast.ts .opencode/themes/poimandres-light.json | grep -E "text\.(dark|light)" | grep -v "4.5:1"
Expected output: No output (all text pairs meet 4.5:1)
  </verify>
  <done>
WCAG AA compliance validation confirms:
- 100% of color pairs pass (24/24)
- All text pairs meet 4.5:1 contrast ratio
- All UI element pairs meet 3:1 contrast ratio
- No failing color pairs
- Validation report shows "WCAG AA Compliance: 100%"
  </done>
</task>

<task type="auto">
  <name>Task 3: Update README with color tokens and usage examples</name>
  <files>README.md</files>
  <action>
Update README.md with comprehensive documentation:

1. Add new section "### poimandres-light.json" in "## Theme Variants" section
   - Add after poimandres-accessible.json entry (recommended variant section)
   - Description: Light theme variant derived from accessible variant, maintaining Poimandres aesthetic with full WCAG AA compliance
   - Compliance: 100% WCAG AA (24/24 pairs)
   - Aesthetic: 100% faithful to Poimandres (derived from validated accessible colors)
   - Use when: Light mode is preferred, accessibility required

2. Update theme structure section to include poimandres-light.json:
   ```
   .opencode/themes/
   ├── poimandres.json                   # Original theme
   ├── poimandres-turquoise-expanded.json # Expanded palette (50% WCAG AA)
   ├── poimandres-accessible.json          # Accessible variant (100% WCAG AA) ⭐
   └── poimandres-light.json               # Light theme variant (100% WCAG AA)
   ```

3. Add new section "## Color Tokens (All Variants)" after "## Color Palette" section
   - Create table with columns: Token Name, poimandres.json (Original), poimandres-accessible.json, poimandres-light.json
   - List all 20 defs colors from each variant (poimandresBg, poimandresGray, poimandresBrightMint, poimandresStrongTurquoise, etc.)
   - Include hex values for each color
   - Format as markdown table for easy comparison

4. Add new section "## Theme Switching" after "## Usage" section
   - Document /theme command usage
   - Example: "Type /theme and select 'poimandres-light' to switch to light theme"
   - Example: "Type /theme and select 'poimandres-accessible' to switch to accessible dark theme"
   - Document theme persistence across OpenCode sessions
   - Note: All four theme variants are available and can be switched at any time

5. Update variant comparison table in "## Theme Variants" section
   - Add row for poimandres-light.json
   - Include: Compliance (100% WCAG AA), Aesthetic (100% faithful), Use case (light mode preference)
   - Maintain existing entries for poimandres.json, poimandres-turquoise-expanded.json, poimandres-accessible.json

6. Add installation instruction for poimandres-light.json in "## Installation" section
   ```
   curl -o ~/.config/opencode/themes/poimandres-light.json https://raw.githubusercontent.com/ajaxdude/opencode-ai-poimandres-theme/main/.opencode/themes/poimandres-light.json
   ```

Ensure markdown formatting is correct, tables are aligned, and links work properly.
  </action>
  <verify>
Check README.md contains poimandres-light.json variant section:
Command: grep -c "poimandres-light.json" README.md
Expected output: 5 or more (multiple references)

Check color tokens section exists:
Command: grep "### Color Tokens (All Variants)" README.md
Expected output: "### Color Tokens (All Variants)"

Check theme switching section exists:
Command: grep "### Theme Switching" README.md
Expected output: "### Theme Switching"

Verify markdown table formatting (no broken tables):
Command: grep -c "^|" README.md
Expected output: 40 or more (markdown table rows)

Check installation command for poimandres-light.json:
Command: grep "poimandres-light.json" README.md | grep curl
Expected output: curl command for downloading poimandres-light.json
  </verify>
  <done>
README.md updated with:
- New poimandres-light.json variant section in Theme Variants (description, compliance, aesthetic, use case)
- Updated theme structure section listing all four theme files
- New "Color Tokens (All Variants)" section with comparison table of 20 defs colors from all variants
- New "Theme Switching" section with /theme command usage examples
- Updated variant comparison table including poimandres-light.json
- Installation instruction for poimandres-light.json in Installation section
- All markdown formatting correct, tables aligned, links working
  </done>
</task>

</tasks>

<verification>
After completing all tasks, verify:
1. File .opencode/themes/poimandres-light.json exists and is valid JSON
2. All 56 theme properties defined with dark and light variants
3. WCAG AA validation shows 100% compliance (24/24 pairs pass)
4. README.md documents all four theme variants with comparison table
5. README.md has color tokens table showing all 20 defs colors with hex values
6. README.md has theme switching usage examples with /theme command
7. Theme file can be selected via /theme command in OpenCode (manual verification during execution)
</verification>

<success_criteria>
- Light theme variant file (.opencode/themes/poimandres-light.json) created with 20+ color definitions and 56 theme properties
- WCAG AA compliance validated at 100% (24/24 color pairs pass)
- README.md updated with comprehensive color tokens documentation (20 defs colors from all 4 variants)
- README.md includes theme switching usage examples and variant comparison table
- All theme files documented in README.md with installation instructions
- Poimandres aesthetic maintained in light theme (colors derived from accessible variant)
</success_criteria>

<output>
After completion, create `.planning/phases/02-light-theme-ux/02-01-SUMMARY.md`
</output>
