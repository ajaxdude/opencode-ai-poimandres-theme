---
phase: 01-dark-theme-foundation
plan: 02
type: execute
wave: 2
depends_on:
  - 01-01
files_modified:
  - .opencode/themes/poimandres-turquoise-expanded.json
autonomous: true
must_haves:
  truths:
    - "New theme variant file follows poimandres.json structure exactly"
    - "Extended turquoise colors integrated into defs section"
    - "Semantic mappings reference new turquoise shades where appropriate"
    - "Dark mode uses turquoise-expanded colors, light mode preserved from original"
    - "JSON schema validation passes (https://opencode.ai/theme.json)"
  artifacts:
    - path: ".opencode/themes/poimandres-turquoise-expanded.json"
      provides: "Complete theme variant with extended turquoise palette"
      min_lines: 250
  key_links:
    - from: ".opencode/themes/poimandres-turquoise-expanded.json"
      to: "poimandres.json"
      via: "same structure pattern"
      pattern: "\\$schema|defs|theme"
    - from: ".opencode/themes/poimandres-turquoise-expanded.json/defs"
      to: "scripts/generate-turquoise-palette.ts"
      via: "uses generated colors"
      pattern: "poimandresTurquoise"
---

<objective>
Create turquoise-expanded theme variant with extended palette integration

Purpose: Produce a new OpenCode theme variant that leverages the extended turquoise palette while maintaining compatibility
Output: Complete theme variant file (poimandres-turquoise-expanded.json)
</objective>

<execution_context>
@/home/papa/.config/opencode/get-shit-done/workflows/execute-plan.md
@/home/papa/.config/opencode/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.opencode/themes/poimandres.json
@.planning/phases/01-dark-theme-foundation/01-01-SUMMARY.md
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create turquoise-expanded variant file with semantic tokens</name>
  <files>.opencode/themes/poimandres-turquoise-expanded.json</files>
  <action>
  Create new theme variant file by copying poimandres.json structure and integrating extended turquoise colors:

  1. **File Structure:**
     - Copy exact structure from poimandres.json
     - Keep $schema reference: "https://opencode.ai/theme.json"
     - Maintain all existing defs and theme properties

  2. **Defs Section Updates (Core Tokens):**
     - Keep all existing color definitions
     - Add 7 new turquoise shades from Plan 01 output:
     ```json
     "poimandresTurquoise50": "#E0FFFF",
     "poimandresTurquoise100": "#BFFFFD",
     "poimandresTurquoise300": "#40E0D0",
     "poimandresTurquoise400": "#00CED1",
     "poimandresTurquoise500": "#00A8A8",
     "poimandresTurquoise700": "#005858",
     "poimandresTurquoise900": "#000808"
     ```
   - Note: `poimandresTurquoise400` should duplicate existing `poimandresStrongTurquoise` (#00CED1)

3. **Semantic Mapping Updates (dark mode only):**
   Update these properties to use expanded turquoise palette (dark variant only):

   - `primary.dark`: `poimandresTurquoise400` (was poimandresBrightMint)
   - `accent.dark`: `poimandresTurquoise500` (was poimandresStrongTurquoise)
   - `success.dark`: `poimandresTurquoise500` (was poimandresStrongTurquoise)
   - `info.dark`: `poimandresTurquoise300` (was poimandresBrightMint)
   - `diffAdded.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `diffHighlightAdded.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `markdownHeading.dark`: `poimandresTurquoise300` (was poimandresBrightMint)
   - `markdownLinkText.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `markdownCode.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `markdownListItem.dark`: `poimandresTurquoise300` (was poimandresBrightMint)
   - `markdownListEnumeration.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `markdownImageText.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `syntaxFunction.dark`: `poimandresTurquoise300` (was poimandresBrightMint)
   - `syntaxVariable.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `syntaxString.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `syntaxType.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `InputBorder.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `InputBorderActive.dark`: `poimandresTurquoise300` (was poimandresLowerMint)
   - `inputPrompt.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)
   - `inputCursor.dark`: `poimandresTurquoise400` (was poimandresStrongTurquoise)

4. **Light Mode Preservation:**
   - Keep all light mode variants unchanged from poimandres.json
   - Only dark mode uses the expanded turquoise palette
   - This ensures light mode continues to work as before

5. **Validation Requirements:**
   - File must be valid JSON
   - Must match poimandres.json structure exactly
   - All color references must exist in defs section
   - No duplicate keys
   - Proper 2-space indentation

DO NOT modify the original poimandres.json file - create only the new variant.
  </action>
  <verify>
  ```bash
  # Verify JSON is valid
  node -e "JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-turquoise-expanded.json', 'utf8')); console.log('Valid JSON')"

  # Verify structure matches poimandres.json
  node -e "
  const orig = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres.json', 'utf8'));
  const variant = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-turquoise-expanded.json', 'utf8'));

  // Check top-level keys
  const origKeys = Object.keys(orig).sort();
  const variantKeys = Object.keys(variant).sort();
  const match = JSON.stringify(origKeys) === JSON.stringify(variantKeys);
  console.log('Top-level structure matches:', match ? 'YES' : 'NO');

  // Check theme property keys
  const origThemeKeys = Object.keys(orig.theme).sort();
  const variantThemeKeys = Object.keys(variant.theme).sort();
  console.log('Theme structure matches:', JSON.stringify(origThemeKeys) === JSON.stringify(variantThemeKeys) ? 'YES' : 'NO');
  "

  # Verify all color refs exist in defs
  node -e "
  const theme = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-turquoise-expanded.json', 'utf8'));
  const defs = Object.keys(theme.defs);

  function checkRefs(obj, path = '') {
    for (const [key, value] of Object.entries(obj)) {
      if (typeof value === 'string' && !defs.includes(value)) {
        console.log('Missing ref:', value, 'at', path + key);
      } else if (typeof value === 'object' && value !== null) {
        checkRefs(value, path + key + '.');
      }
    }
  }
  checkRefs(theme.theme);
  console.log('All refs verified');
  "

  # Verify schema reference
  grep -q '"\$schema": "https://opencode.ai/theme.json"' .opencode/themes/poimandres-turquoise-expanded.json && echo "Schema correct" || echo "Schema missing"
  ```
  </verify>
  <done>
  - File is valid JSON with correct structure
  - All top-level keys match poimandres.json
  - 7 new turquoise colors added to defs
  - Dark mode uses expanded turquoise palette
  - Light mode unchanged from original
  - All color references exist in defs section
  - Schema reference present
  </done>
</task>

<task type="auto">
  <name>Task 2: Validate semantic token completeness</name>
  <files>.opencode/themes/poimandres-turquoise-expanded.json</files>
  <action>
  Validate that all semantic token categories are defined with complete mappings:

  1. **Core Token Validation:**
     - Verify all color definitions in `defs` section have valid hex values
     - Verify no duplicate color names
     - Verify no undefined color references

  2. **Extension Token Validation (Semantic Mappings):**
     Verify these semantic categories have both `.dark` and `.light` variants:
     - Background layers: `background`, `backgroundPanel`
     - Text layers: `text`, `textMuted`, `textInverse`
     - Semantic colors: `primary`, `secondary`, `accent`, `success`, `info`, `warning`, `error`
     - UI states: `focus`, `active`, `disabled`
     - Interactive elements: `link`, `button`, `input`

  3. **Component Token Validation:**
     Verify these component categories are defined for dark mode:
     - Markdown: `markdownHeading`, `markdownLinkText`, `markdownCode`, `markdownListItem`, `markdownListEnumeration`, `markdownImageText`
     - Syntax: `syntaxFunction`, `syntaxVariable`, `syntaxString`, `syntaxType`, `syntaxKeyword`, `syntaxComment`, `syntaxConstant`, `syntaxNumber`
     - Inputs: `InputBorder`, `InputBorderActive`, `inputBackground`, `inputCursor`, `inputPrompt`
     - Diffs: `diffAdded`, `diffRemoved`, `diffHighlightAdded`, `diffHighlightRemoved`

  4. **Validation Script:**
     Create a validation check that:
     - Reads theme JSON
     - Iterates through `theme` object
     - Verifies every value references a key in `defs`
     - Verifies every dark mode property has corresponding light mode property
     - Reports any missing tokens or broken references
   </action>
  <verify>
  ```bash
  # Run semantic token validation
  node -e "
  const theme = JSON.parse(require('fs').readFileSync('.opencode/themes/poimandres-turquoise-expanded.json', 'utf8'));
  const defs = Object.keys(theme.defs);

  function validateTokens(obj, path = '') {
    for (const [key, value] of Object.entries(obj)) {
      if (typeof value === 'object' && value !== null && !value.dark && !value.light) {
        validateTokens(value, path + key + '.');
      } else if (typeof value === 'string') {
        if (!defs.includes(value)) {
          console.log('Undefined reference:', value, 'at', path + key);
          process.exit(1);
        }
      }
    }
  }

  validateTokens(theme.theme);
  console.log('✓ All token references are valid');

  // Verify semantic categories
  const requiredCategories = ['primary', 'secondary', 'accent', 'success', 'info', 'warning', 'error'];
  requiredCategories.forEach(cat => {
    if (!theme.theme[cat] || !theme.theme[cat].dark || !theme.theme[cat].light) {
      console.log('Missing semantic category:', cat);
      process.exit(1);
    }
  });
  console.log('✓ All semantic categories defined');
  "
  ```
  </verify>
  <done>
  - All color references in theme resolve to defs section
  - All semantic categories (primary, secondary, accent, success, info, warning, error) have dark/light variants
  - All component tokens (markdown, syntax, inputs, diffs) are defined
  - No undefined color references
  - No duplicate color definitions
  </done>
</task>

</tasks>

<verification>
1. Verify JSON validity of new theme file
2. Confirm structure matches poimandres.json exactly
3. Verify all color references exist in defs
4. Validate semantic token completeness (core + extensions + components)
5. Confirm dark mode uses turquoise palette
6. Confirm light mode is unchanged
7. Verify schema reference is correct
</verification>

<success_criteria>
- Theme variant file created with valid JSON
- Structure matches poimandres.json exactly
- 7 extended turquoise shades integrated
- Dark mode semantic mappings updated to use turquoise palette
- Light mode preserved from original
- All color references resolve to defs
- All semantic tokens validated (core + extensions + components)
</success_criteria>

<output>
After completion, create `.planning/phases/01-dark-theme-foundation/01-02-SUMMARY.md`
</output>
